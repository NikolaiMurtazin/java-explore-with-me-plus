Subject: [PATCH] Основа
---
Index: docker-compose.yml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/docker-compose.yml b/docker-compose.yml
--- a/docker-compose.yml	(revision 3c6d688cf755d1777c1f0d040f7e0dc041ad2c84)
+++ b/docker-compose.yml	(revision 9b3f0266ee20f168d0bfb3aed7149aded7862346)
@@ -1,14 +1,57 @@
 services:
   stats-server:
+    build: stats/stats-service
+    container_name: stats-server
     ports:
       - "9090:9090"
+    depends_on:
+      - ewm-service
+      - stats-db
+    environment:
+      - SPRING_DATASOURCE_URL=jdbc:postgresql://stats-db:5432/stats
+      - SPRING_DATASOURCE_USERNAME=stats
+      - SPRING_DATASOURCE_PASSWORD=stats
 
   stats-db:
     image: postgres:16.1
+    container_name: postgres-stats
+    ports:
+      - "6432:5432"
+    environment:
+      - POSTGRES_DB=stats
+      - POSTGRES_USER=stats
+      - POSTGRES_PASSWORD=stats
+    healthcheck:
+      test: pg_isready -q -d $$POSTGRES_DB -U $$POSTGRES_USER
+      timeout: 5s
+      interval: 5s
+      retries: 10
 
   ewm-service:
+    build: main
+    image: main-service
+    container_name: main
     ports:
       - "8080:8080"
+    depends_on:
+      - ewm-db
+    environment:
+      - CLIENT_URL=http://stats-service:9090
+      - SPRING_DATASOURCE_URL=jdbc:postgresql://ewm-db:5431/main
+      - SPRING_DATASOURCE_USERNAME=main
+      - SPRING_DATASOURCE_PASSWORD=main
 
   ewm-db:
     image: postgres:16.1
+    container_name: postgres-main
+    ports:
+      - "6431:5431"
+    environment:
+      - POSTGRES_DB=main
+      - POSTGRES_USER=main
+      - POSTGRES_PASSWORD=main
+    healthcheck:
+      test: pg_isready -q -d $$POSTGRES_DB -U $$POSTGRES_USER
+      timeout: 5s
+      interval: 5s
+      retries: 10
Index: main-service/Dockerfile
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/main-service/Dockerfile b/main-service/Dockerfile
new file mode 100644
--- /dev/null	(revision 9b3f0266ee20f168d0bfb3aed7149aded7862346)
+++ b/main-service/Dockerfile	(revision 9b3f0266ee20f168d0bfb3aed7149aded7862346)
@@ -0,0 +1,9 @@
+FROM eclipse-temurin:21-jre-jammy
+
+VOLUME /tmp
+
+ARG JAR_FILE=target/*.jar
+
+COPY ${JAR_FILE} app.jar
+
+ENTRYPOINT ["sh", "-c", "java ${JAVA_OPTS} -jar /app.jar"]
\ No newline at end of file
Index: main-service/pom.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/main-service/pom.xml b/main-service/pom.xml
new file mode 100644
--- /dev/null	(revision 9b3f0266ee20f168d0bfb3aed7149aded7862346)
+++ b/main-service/pom.xml	(revision 9b3f0266ee20f168d0bfb3aed7149aded7862346)
@@ -0,0 +1,73 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<project xmlns="http://maven.apache.org/POM/4.0.0"
+         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
+         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
+    <modelVersion>4.0.0</modelVersion>
+    <parent>
+        <groupId>ru.practicum</groupId>
+        <artifactId>explore-with-me</artifactId>
+        <version>0.0.1-SNAPSHOT</version>
+    </parent>
+
+    <artifactId>main-service</artifactId>
+
+    <properties>
+        <maven.compiler.source>21</maven.compiler.source>
+        <maven.compiler.target>21</maven.compiler.target>
+        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
+    </properties>
+
+    <dependencies>
+        <dependency>
+            <groupId>ru.practicum</groupId>
+            <artifactId>stats-client</artifactId>
+            <version>0.0.1-SNAPSHOT</version>
+        </dependency>
+        <dependency>
+            <groupId>org.springframework.boot</groupId>
+            <artifactId>spring-boot-starter-web</artifactId>
+        </dependency>
+
+        <dependency>
+            <groupId>org.springframework.boot</groupId>
+            <artifactId>spring-boot-starter-actuator</artifactId>
+        </dependency>
+
+        <dependency>
+            <groupId>org.hibernate.validator</groupId>
+            <artifactId>hibernate-validator</artifactId>
+        </dependency>
+
+        <dependency>
+            <groupId>org.apache.httpcomponents.client5</groupId>
+            <artifactId>httpclient5</artifactId>
+        </dependency>
+
+        <dependency>
+            <groupId>org.springframework.boot</groupId>
+            <artifactId>spring-boot-configuration-processor</artifactId>
+            <optional>true</optional>
+        </dependency>
+
+        <dependency>
+            <groupId>org.projectlombok</groupId>
+            <artifactId>lombok</artifactId>
+            <optional>true</optional>
+        </dependency>
+
+        <dependency>
+            <groupId>org.springframework.boot</groupId>
+            <artifactId>spring-boot-starter-test</artifactId>
+            <scope>test</scope>
+        </dependency>
+    </dependencies>
+
+    <build>
+        <plugins>
+            <plugin>
+                <groupId>org.springframework.boot</groupId>
+                <artifactId>spring-boot-maven-plugin</artifactId>
+            </plugin>
+        </plugins>
+    </build>
+</project>
\ No newline at end of file
Index: main-service/src/main/java/ru/practicum/Main.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/main-service/src/main/java/ru/practicum/Main.java b/main-service/src/main/java/ru/practicum/Main.java
new file mode 100644
--- /dev/null	(revision 9b3f0266ee20f168d0bfb3aed7149aded7862346)
+++ b/main-service/src/main/java/ru/practicum/Main.java	(revision 9b3f0266ee20f168d0bfb3aed7149aded7862346)
@@ -0,0 +1,13 @@
+package ru.practicum;
+
+import org.springframework.boot.SpringApplication;
+import org.springframework.boot.autoconfigure.SpringBootApplication;
+import org.springframework.context.annotation.ComponentScan;
+
+@SpringBootApplication
+@ComponentScan(basePackages = {"ru.practicum", "ru.practicum.client"})
+public class Main {
+    public static void main(String[] args) {
+        SpringApplication.run(Main.class, args);
+    }
+}
\ No newline at end of file
Index: main-service/src/main/resources/application.properties
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>ISO-8859-1
===================================================================
diff --git a/main-service/src/main/resources/application.properties b/main-service/src/main/resources/application.properties
new file mode 100644
--- /dev/null	(revision 9b3f0266ee20f168d0bfb3aed7149aded7862346)
+++ b/main-service/src/main/resources/application.properties	(revision 9b3f0266ee20f168d0bfb3aed7149aded7862346)
@@ -0,0 +1,8 @@
+logging.level.org.springframework.web.client.RestClient=DEBUG
+server.port=8080
+
+client.url=http://localhost:9090
+spring.datasource.driver-class-name=org.postgresql.Driver
+spring.datasource.url=jdbc:postgresql://localhost:6431/main
+spring.datasource.username=main
+spring.datasource.password=main
Index: pom.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/pom.xml b/pom.xml
--- a/pom.xml	(revision 3c6d688cf755d1777c1f0d040f7e0dc041ad2c84)
+++ b/pom.xml	(revision 9b3f0266ee20f168d0bfb3aed7149aded7862346)
@@ -11,8 +11,12 @@
 	</parent>
 
 	<name>Explore With Me</name>
+    <modules>
+		<module>stats-service</module>
+		<module>main-service</module>
+	</modules>
 
-	<groupId>ru.practicum</groupId>
+    <groupId>ru.practicum</groupId>
 	<artifactId>explore-with-me</artifactId>
 	<version>0.0.1-SNAPSHOT</version>
 	<packaging>pom</packaging>
Index: stats-service/Dockerfile
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/stats-service/Dockerfile b/stats-service/Dockerfile
new file mode 100644
--- /dev/null	(revision 9b3f0266ee20f168d0bfb3aed7149aded7862346)
+++ b/stats-service/Dockerfile	(revision 9b3f0266ee20f168d0bfb3aed7149aded7862346)
@@ -0,0 +1,9 @@
+FROM eclipse-temurin:21-jre-jammy
+
+VOLUME /tmp
+
+ARG JAR_FILE=target/*.jar
+
+COPY ${JAR_FILE} app.jar
+
+ENTRYPOINT ["sh", "-c", "java ${JAVA_OPTS} -jar /app.jar"]
\ No newline at end of file
Index: stats-service/pom.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/stats-service/pom.xml b/stats-service/pom.xml
new file mode 100644
--- /dev/null	(revision 9b3f0266ee20f168d0bfb3aed7149aded7862346)
+++ b/stats-service/pom.xml	(revision 9b3f0266ee20f168d0bfb3aed7149aded7862346)
@@ -0,0 +1,76 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<project xmlns="http://maven.apache.org/POM/4.0.0"
+         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
+         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
+    <modelVersion>4.0.0</modelVersion>
+    <parent>
+        <groupId>ru.practicum</groupId>
+        <artifactId>explore-with-me</artifactId>
+        <version>0.0.1-SNAPSHOT</version>
+    </parent>
+
+    <artifactId>stats-service</artifactId>
+    <packaging>pom</packaging>
+    <modules>
+        <module>stats-client</module>
+    </modules>
+
+    <properties>
+        <maven.compiler.source>21</maven.compiler.source>
+        <maven.compiler.target>21</maven.compiler.target>
+        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
+    </properties>
+    <dependencies>
+        <dependency>
+            <groupId>org.springframework.boot</groupId>
+            <artifactId>spring-boot-starter-web</artifactId>
+        </dependency>
+
+        <dependency>
+            <groupId>org.springframework.boot</groupId>
+            <artifactId>spring-boot-starter-validation</artifactId>
+        </dependency>
+
+        <dependency>
+            <groupId>org.springframework.boot</groupId>
+            <artifactId>spring-boot-starter-actuator</artifactId>
+        </dependency>
+
+        <dependency>
+            <groupId>org.hibernate.validator</groupId>
+            <artifactId>hibernate-validator</artifactId>
+        </dependency>
+
+        <dependency>
+            <groupId>org.apache.httpcomponents.client5</groupId>
+            <artifactId>httpclient5</artifactId>
+        </dependency>
+
+        <dependency>
+            <groupId>org.springframework.boot</groupId>
+            <artifactId>spring-boot-configuration-processor</artifactId>
+            <optional>true</optional>
+        </dependency>
+
+        <dependency>
+            <groupId>org.projectlombok</groupId>
+            <artifactId>lombok</artifactId>
+            <optional>true</optional>
+        </dependency>
+
+        <dependency>
+            <groupId>org.springframework.boot</groupId>
+            <artifactId>spring-boot-starter-test</artifactId>
+            <scope>test</scope>
+        </dependency>
+    </dependencies>
+
+    <build>
+        <plugins>
+            <plugin>
+                <groupId>org.springframework.boot</groupId>
+                <artifactId>spring-boot-maven-plugin</artifactId>
+            </plugin>
+        </plugins>
+    </build>
+</project>
\ No newline at end of file
Index: stats-service/src/main/java/ru/practicum/Main.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/stats-service/src/main/java/ru/practicum/Main.java b/stats-service/src/main/java/ru/practicum/Main.java
new file mode 100644
--- /dev/null	(revision 9b3f0266ee20f168d0bfb3aed7149aded7862346)
+++ b/stats-service/src/main/java/ru/practicum/Main.java	(revision 9b3f0266ee20f168d0bfb3aed7149aded7862346)
@@ -0,0 +1,7 @@
+package ru.practicum;
+
+public class Main {
+    public static void main(String[] args) {
+
+    }
+}
\ No newline at end of file
Index: stats-service/stats-client/pom.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/stats-service/stats-client/pom.xml b/stats-service/stats-client/pom.xml
new file mode 100644
--- /dev/null	(revision 9b3f0266ee20f168d0bfb3aed7149aded7862346)
+++ b/stats-service/stats-client/pom.xml	(revision 9b3f0266ee20f168d0bfb3aed7149aded7862346)
@@ -0,0 +1,20 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<project xmlns="http://maven.apache.org/POM/4.0.0"
+         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
+         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
+    <modelVersion>4.0.0</modelVersion>
+    <parent>
+        <groupId>ru.practicum</groupId>
+        <artifactId>stats-service</artifactId>
+        <version>0.0.1-SNAPSHOT</version>
+    </parent>
+
+    <artifactId>stats-client</artifactId>
+
+    <properties>
+        <maven.compiler.source>21</maven.compiler.source>
+        <maven.compiler.target>21</maven.compiler.target>
+        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
+    </properties>
+
+</project>
\ No newline at end of file
Index: stats-service/stats-client/src/main/java/ru/practicum/Main.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/stats-service/stats-client/src/main/java/ru/practicum/Main.java b/stats-service/stats-client/src/main/java/ru/practicum/Main.java
new file mode 100644
--- /dev/null	(revision 9b3f0266ee20f168d0bfb3aed7149aded7862346)
+++ b/stats-service/stats-client/src/main/java/ru/practicum/Main.java	(revision 9b3f0266ee20f168d0bfb3aed7149aded7862346)
@@ -0,0 +1,6 @@
+package ru.practicum;
+
+public class Main {
+    public static void main(String[] args) {
+    }
+}
\ No newline at end of file
Index: stats-service/stats-client/src/main/java/ru/practicum/client/StatClient.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/stats-service/stats-client/src/main/java/ru/practicum/client/StatClient.java b/stats-service/stats-client/src/main/java/ru/practicum/client/StatClient.java
new file mode 100644
--- /dev/null	(revision 9b3f0266ee20f168d0bfb3aed7149aded7862346)
+++ b/stats-service/stats-client/src/main/java/ru/practicum/client/StatClient.java	(revision 9b3f0266ee20f168d0bfb3aed7149aded7862346)
@@ -0,0 +1,24 @@
+package ru.practicum.client;
+
+import org.springframework.beans.factory.annotation.Autowired;
+import org.springframework.beans.factory.annotation.Value;
+import org.springframework.stereotype.Component;
+import org.springframework.web.client.RestClient;
+
+@Component
+public class StatClient {
+    final RestClient client;
+    final String statUrl;
+
+    @Autowired
+    public StatClient(RestClient client, @Value("${client.url") String startUrl) {
+        this.client= client;
+        this.statUrl = startUrl;
+    }
+
+    protected
+    String result = restClient.get()
+            .uri(uriBase + "/articles")
+            .retrieve()
+            .body(String.class);
+}
Index: stats-service/stats-client/src/main/resources/application.properties
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>ISO-8859-1
===================================================================
diff --git a/stats-service/stats-client/src/main/resources/application.properties b/stats-service/stats-client/src/main/resources/application.properties
new file mode 100644
--- /dev/null	(revision 9b3f0266ee20f168d0bfb3aed7149aded7862346)
+++ b/stats-service/stats-client/src/main/resources/application.properties	(revision 9b3f0266ee20f168d0bfb3aed7149aded7862346)
@@ -0,0 +1,8 @@
+logging.level.org.springframework.web.client.RestClient=DEBUG
+server.port=9090
+
+client.url=http://localhost:9090
+spring.datasource.driver-class-name=org.postgresql.Driver
+spring.datasource.url=jdbc:postgresql://localhost:6432/stats
+spring.datasource.username=stats
+spring.datasource.password=stats
